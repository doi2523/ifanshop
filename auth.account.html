<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User List</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>
    <h1 class="container">User List</h1>
    <div class="container">
        <button style="border-radius: 10px; padding: 10px;">
            <a style="font-size: 20px;" href="auth.admin.html">
            <ion-icon style="height: 30px; width: 30px;" name="arrow-back-outline"></ion-icon> 
            Quay lại</a>
        </button>
    </div>
    <div class="container mt-3">
        <table class="table table-dark">
            <thead>
                <th>STT</th>
                <th>Username</th>
                <th>Email</th>
                <th>Password</th>
                <th>Tuỳ chọn</th>
            </thead>
            <tbody id="tbody1"></tbody>
        </table>
    </div>
</body>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-analytics.js";
  import { getDatabase, ref, child, onValue, get } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";
  import { getAuth, deleteUser } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCnZzlFSm-61oaNvO2TTJyef2PMc6iU8DY",
    authDomain: "user-inifanshop.firebaseapp.com",
    databaseURL: "https://user-inifanshop-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "user-inifanshop",
    storageBucket: "user-inifanshop.appspot.com",
    messagingSenderId: "104690936940",
    appId: "1:104690936940:web:5398fbb0edae0c7a76bc49",
    measurementId: "G-NLBDR28748"
  };
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const database = getDatabase(app);
  const auth = getAuth();

    var stdNo =0;
    var tbody = document.getElementById('tbody1')
    function AddItemToTable(username, email, passwd){
        let trow = document.createElement("tr");
        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");
        let td4 = document.createElement("td");
        let td5 = document.createElement("td");

        td1.innerHTML=++stdNo;
        td2.innerHTML= username;
        td3.innerHTML= email;
        td4.innerHTML= passwd;
        td5.innerHTML = '<button onclick="edit()">Sửa</button><button onclick="del()">Xoá</button>';

        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);
        trow.appendChild(td5);

        tbody.appendChild(trow);
    }
    function AddAllItemToTable(UserList){
        stdNo=0;
        tbody.innerHTML="";
        UserList.forEach(element => {
            AddItemToTable(element.username,element.email,element.password)
        });
    };

    function GetAllDataOnce(){
        const databaseRef = ref (database);

        get(child(databaseRef, "users"))
        .then((snapshot)=>{
            var usrs = [];

            snapshot.forEach(childSnapshot => {
                usrs.push(childSnapshot.val());
            });

            AddAllItemToTable(usrs);
        })
    }
    window.onload = GetAllDataOnce;

    let editButton = document.createElement("button");
    editButton.textContent = "Sửa";
    editButton.onclick = function() {
        // Thực hiện hành động khi nút "Sửa" được click
        edit(username);
    };
    
    let deleteButton = document.createElement("button");
    deleteButton.textContent = "Xoá";
    deleteButton.onclick = function() {
        // Thực hiện hành động khi nút "Xoá" được click
        del(username);
    };
    function del(username) {
    // Xóa dữ liệu từ cơ sở dữ liệu thời gian thực ứng với username
    // Ví dụ sử dụng Realtime Database của Firebase:
    firebase.database().ref('users/' + user.uid).remove()
        .then(function() {
            // Xóa thành công
            console.log("Đã xóa dữ liệu thành công!");
        })
        .catch(function(error) {
            // Xử lý lỗi nếu có
            console.error("Lỗi khi xóa dữ liệu:", error);
        });
}

</script>
<script type="module" src="js/checklogin.js"></script>
</html>
