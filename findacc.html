<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Email Verification</title>
<script src="https://smtpjs.com/v3/smtp.js"></script>
</head>
<body>

<form id="emailForm">
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    <button type="button" id="sendVerification">Send Verification Code</button>
</form>

<form id="verificationForm">
    <label for="verification">Verification code:</label>
    <input type="text" id="verification" name="verification" required>
    <button type="submit">Verify</button>
</form>

<script>
// Gửi email với mã xác thực
function sendEmail(email, verificationCode) {
  Email.send({
    Host: "smtp.elasticemail.com",
    Username: "ifanshopmail@gmail.com",
    Password: "E7F0319C5DD68A220A8069A1681B6CB57ED2",
    To: email,
    From: "ifanshopmail@gmail.com",
    Subject: "iFanShop Verification",
    Body: "Mã xác thực của bạn là: " + verificationCode
  }).then(
    message => alert(message)
  );
}

// Tạo mã xác thực
function generateVerificationCode(length) {
  var code = '';
  var characters = '0123456789'; // Các ký tự có thể sử dụng cho mã xác thực
  for (var i = 0; i < length; i++) {
    var randomIndex = Math.floor(Math.random() * characters.length);
    code += characters[randomIndex];
  }
  return code;
}

// Sự kiện khi người dùng nhấn nút "Send Verification Code"
document.getElementById("sendVerification").addEventListener("click", function() {
    var email = document.getElementById("email").value;
    var verificationCode = generateVerificationCode(6); // Tạo mã xác thực có 6 chữ số
    localStorage.setItem("verificationCode", verificationCode); // Lưu mã xác thực vào localStorage
    sendEmail(email, verificationCode); // Gửi email với mã xác thực
});

// Sự kiện khi người dùng gửi form kiểm tra mã xác thực
document.getElementById("verificationForm").addEventListener("submit", function(event) {
  event.preventDefault(); // Ngăn chặn form submit

  // Lấy mã xác thực từ trường nhập liệu
  var verificationCode = document.getElementById("verification").value;

  // So sánh với mã xác thực được lưu trong localStorage
  if (verificationCode === localStorage.getItem("verificationCode")) {
      window.location.href = "index.html"; // Chuyển hướng tới trang index.html nếu mã xác thực đúng
  } else {
      alert("Mã xác thực không đúng. Vui lòng nhập lại.");
  }
});
</script>

</body>
</html>
